<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Detail â€” {{ token.company_name }}</title>
    <link rel="stylesheet" href="/static/css/style.css?v={{ cache_bust }}">
    {% if photo.latitude and photo.longitude %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    {% endif %}
    <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">
    <link rel="manifest" href="/c/{{ token.token }}/manifest.json">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
    <div class="capture-container">
        <div class="capture-header">
            {% if token.logo_file %}
            <div class="header-row">
                <img src="/static/logos/{{ token.logo_file }}" alt="{{ token.company_name }}" class="company-logo">
                <div class="header-text">
                    <div class="company-name">{{ token.company_name }}</div>
                    <h1>Photo Detail</h1>
                </div>
            </div>
            {% else %}
            <div class="company-name">{{ token.company_name }}</div>
            <h1>Photo Detail</h1>
            {% endif %}
            <a href="/photo-library?token={{ token.token }}" class="back-to-home">Back to Library</a>
        </div>

        <div style="margin-top: 16px;">
            <img src="/api/job-photos/{{ photo.id }}" alt="Photo"
                 style="width: 100%; border-radius: 8px; border: 1px solid var(--gray-200);">
        </div>

        <div class="meta-card" style="margin-top: 16px;">
            <div style="margin-bottom: 8px;">
                <strong style="color: var(--gray-500); font-size: 12px; text-transform: uppercase;">Job</strong>
                <div style="font-weight: 600;">{{ photo.job_name }}</div>
                {% if photo.job_address %}
                <div style="color: var(--gray-500); font-size: 13px;">{{ photo.job_address }}</div>
                {% endif %}
            </div>

            {% if photo.caption %}
            <div style="margin-bottom: 8px;">
                <strong style="color: var(--gray-500); font-size: 12px; text-transform: uppercase;">Caption</strong>
                <div>{{ photo.caption }}</div>
            </div>
            {% endif %}

            <div style="margin-bottom: 8px;">
                <strong style="color: var(--gray-500); font-size: 12px; text-transform: uppercase;">Date</strong>
                <div>{{ photo.created_at|fmt_datetime }}</div>
            </div>

            {% if photo.latitude and photo.longitude %}
            <div style="margin-bottom: 8px;">
                <strong style="color: var(--gray-500); font-size: 12px; text-transform: uppercase;">Location</strong>
                <div id="photo-map" style="height: 200px; border-radius: 8px; margin-top: 4px; cursor: pointer;" onclick="expandMap()"></div>
                <a href="https://maps.google.com/?q={{ photo.latitude }},{{ photo.longitude }}" target="_blank"
                   style="font-size: 13px; margin-top: 4px; display: inline-block;">Open in Google Maps</a>
            </div>
            {% endif %}
        </div>
    </div>
    {% include '_footer.html' %}

    {% if photo.latitude and photo.longitude %}
    <div id="map-overlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); z-index:1000; padding:20px;" onclick="closeMap()">
        <div id="map-full" style="width:100%; height:100%; border-radius:12px;"></div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
    var lat = {{ photo.latitude }};
    var lng = {{ photo.longitude }};
    var miniMap = L.map('photo-map', {zoomControl: false, dragging: false, scrollWheelZoom: false}).setView([lat, lng], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19}).addTo(miniMap);
    L.marker([lat, lng]).addTo(miniMap);

    var fullMap = null;
    function expandMap() {
        document.getElementById('map-overlay').style.display = '';
        if (!fullMap) {
            fullMap = L.map('map-full').setView([lat, lng], 16);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19}).addTo(fullMap);
            L.marker([lat, lng]).addTo(fullMap);
        }
        setTimeout(function() { fullMap.invalidateSize(); }, 100);
    }
    function closeMap() {
        document.getElementById('map-overlay').style.display = 'none';
    }
    </script>
    {% endif %}
</body>
</html>
